pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
--clock
--brettski

function _init()
 debug={}
 t={
  hour=0,
  minute=0,
  second=0,
  t=0,
  h1=0,
  h0=0,
  m1=0,
  m0=0,
  s1=0,
  s0=0,
 }
 init_digital()
 init_analog()
end

function _update()
 --set time
 t.hour=stat(93)
 t.minute=stat(94)
 t.second=stat(95)
 t.t+=1
 t.h1,t.h0=pos10(t.hour)
 t.m1,t.m0=pos10(t.minute)
 t.s1,t.s0=pos10(t.second)

 update_analog()
end

function _draw()
 cls()
 --draw_digital()
 draw_digital2()
 draw_analog()
 --drawdebug()
end

function drawdebug()
 cursor(1,0)
 color(9)
 for txt in all(debug) do
  print(txt)
 end
 if t.t%5==0 then
  del(debug,debug[1])
 end
end
-->8
--analog

function draw_analog()
 circ(clk_cntrx, clk_cntry,
  44,10)
 line(clk_cntrx, clk_cntry-40,
  clk_cntrx, clk_cntry-42,8)
 line(clk_cntrx, clk_cntry,
  hrhand.x,hrhand.y,hrhand.col)
 line(clk_cntrx, clk_cntry,
  minhand.x,minhand.y,minhand.col)
 line(clk_cntrx, clk_cntry,
  sechand.x,sechand.y,sechand.col)
 circfill(clk_cntrx,clk_cntry,1,13)
 circ(clk_cntrx,clk_cntry,2,8)
end

function update_analog()
 --(360/60)*v = angle
 sechand.a=sechand.af(60,t.second)
 minhand.a=minhand.af(60,t.minute)
 hrhand.a=hrhand.af(12,flr(t.hour-12))
 set_hand(sechand)
 set_hand(minhand)
 set_hand(hrhand)
 
end

function set_hand(hand)
 local a=hand.a*-1
 hand.x=clk_cntrx+cos(a)*hand.len
 hand.y=clk_cntry+sin(a)*hand.len
end

function get_hand_a(d,v)
 v=v-15 --zero is at 3:00,adjust
 return ((360/d)*v)/360
end

function init_analog()
 -- clock center
 clk_cntrx=63
 clk_cntry=45

 sechand={
  len=40,
  col=7,
  x=0,
  y=0,
  af=get_hand_a,
  a=0
 }
 minhand={
  len=40,
  col=11,
  x=0,
  y=0,
  af=get_hand_a,
  a=0,
 }
 hrhand={
  len=25,
  col=9,
  x=0,
  y=0,
  af=get_hand_a,
  a=0,
 }
end
-->8
-- digital


function draw_digital()
 local m=pad_0(t.minute)
 local s=pad_0(t.second)
	print(t.hour..":"
		..m..":"
		..s,48,121,7)

end

function draw_digital2()
 pntclkchr(t.h1,0)
 pntclkchr(t.h0,8)
 pntclkchr(10,16)
 pntclkchr(t.m1,24)
 pntclkchr(t.m0,32)
 pntclkchr(10,40)
 pntclkchr(t.s1,48)
 pntclkchr(t.s0,56)
end

function pntclkchr(t,o)
 spr(c77_srt+t,dclk_x+o,dclk_y)
end

function pos10(v)
 return flr(v/10), flr(v%10)
end

function init_digital()
	c77_srt=64 --0, 73=9
	dclk_x=32
	dclk_y=120
	dclk_fw=8
	dclk_c=7 
end

function pad_0(num)
	if num <10 then
	 return "0"..num
	end
	return num
end
__gfx__
bbbbbb110000001100000000000bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbb11000000110000000000bbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000001100000011000000000b0bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b00000110000001100000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b00000110000001100000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b00000110000001100000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb0110000001100000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb0bb110000001100000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000b11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000b11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb0bb11000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb011000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f0000011000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00ccc00000cc00000ccccc00ccccccc0000ccc00cccccc0000cccc00ccccccc00cccc0000ccccc00000000000000000000000000000000000000000000000000
0c00cc000ccc0000cc000cc00000cc0000cccc00cc0000000cc00000cc000cc0c0000c00cc000cc0000c00000000000000000000000000000000000000000000
cc000cc000cc00000000ccc0000cc0000cc0cc00cccccc00cc0000000000cc00cc000c00cc000cc0000000000000000000000000000000000000000000000000
cc000cc000cc000000cccc0000cccc00cc00cc0000000cc0cccccc00000cc0000cccc0000cccccc0000000000000000000000000000000000000000000000000
cc000cc000cc00000cccc00000000cc0ccccccc000000cc0cc000cc000cc0000c00cccc000000cc0000c00000000000000000000000000000000000000000000
0cc00c0000cc0000cc000000cc000cc00000cc00cc000cc0cc000cc000cc0000c0000cc00000cc00000000000000000000000000000000000000000000000000
00ccc000cccccc00ccccccc00ccccc000000cc000ccccc000ccccc0000cc00000ccccc000cccc000000000000000000000000000000000000000000000000000
