pico-8 cartridge // http://www.pico-8.com
version 30
__lua__
-- shooter
-- brettski

function _init()
 loaddata()
 setinitvars()
 setplayer()
 startgame()
end

function _update()
 t+=1
 _upd() 
end

function _draw()
 cls()
 line(0,64,128,64,15)
 drawplr()
 drawbeam()
	drawdebug()
end
-->8
--inits

function setinitvars()
 rocks={}
 debug={}
 debugttl=1
end

function setplayer()
	plr={
		x=64,
		y=80,
		sprt=64, --spritetop
		sprb=80, --spritebottom
  sprbani=8, --sprb ani length
		acc=0.5, --acceleration
  deacc=0.25,  --de-acc factor 
		minx=0,
		miny=64,
		maxx=128-16,
		maxy=128-16,
  xspd=0, --speed traveling x
  yspd=0, --speed traveling y
  maxspd=4,
  beam={},
  bdelay=0, --current delay
  bmax=6, --max laser beam
  bloff={5,0}, --left beam offset
  broff={9,0}, --right beam
	}
	plr.beam.delay=3 --beam delay
end

function startgame()
 _upd=updategame
end
-->8
--updates

function updategame()
 dobutton()
 updbeam()
end

function dobutton()
 local butt = btn()
 if butt & 0x0001 == 1 then
  --‚¨ÖÔ∏è
  moveplr(-1,0)
 elseif butt & 0x0002 == 2 then
  --‚û°Ô∏è
  moveplr(1,0)
 elseif butt & 0x0004 == 4 then
  --‚¨ÜÔ∏è
  moveplr(0,-1)
 elseif butt & 0x0008 == 8 then
  --‚¨áÔ∏è
  moveplr(0,1)
 else
  moveplr(0,0)
 end
 if butt & 0x0010 == 16 then
  --üÖæÔ∏è
 end 
 if butt & 0x0020 == 32 then
  --‚ùé
  firebeam()
 end 
end


function moveplr(_x,_y)
  --_x, _y are a value of 1 in a direction
  --we need to accelarate the ship in that direction
  --by the acc amount. when not accelerating
  --we decelerate until 0.
  --we know as the direction is 0, so we bring
  --the xspd or yspd closer to zero per cycle
 
 if _x != 0 then
  plr.xspd += plr.acc * _x
  plr.xspd = max(min(plr.xspd, plr.maxspd),plr.maxspd * -1)
 elseif t%2==0 then
  if plr.xspd < 0 then
   plr.xspd += plr.deacc
  elseif plr.xspd > 0 then
   plr.xspd -= plr.deacc
  end
 end
 if _y != 0 then 
  plr.yspd += plr.acc * _y
  plr.yspd = max(min(plr.yspd, plr.maxspd),plr.maxspd * -1) 
 elseif t%2==0 then
  if plr.yspd < 0 then
   plr.yspd += plr.deacc
  elseif plr.yspd > 0 then
   plr.yspd -= plr.deacc
  end
 end

 local newx=plr.x+plr.xspd
 local newy=plr.y+plr.yspd
 if newx <= plr.maxx and 
    newx >= plr.minx then
  plr.x=newx
 end
 if newy <= plr.maxy and
    newy >= plr.miny then
  plr.y=newy
 end
end

-->8
--draws

function drawplr()
 local eani=t%plr.sprbani
 spr(plr.sprt,plr.x,plr.y,2,1)
 spr(plr.sprb+eani,plr.x,plr.y+8,1,1)
 spr(plr.sprb+eani,plr.x+8,plr.y+8,1,1,true)
end

function drawdebug()
 cursor(1,16)
 color(4)
 for txt in all(debug) do
  print(txt)
 end
 if t%debugttl==0
  or #debug > 6 then
 	 del(debug,debug[1])
 end
end
-->8
--datas

function loaddata()
 t=0
  
end
-->8
--beam laser

function newbeam(_x,_y)
 add(plr.beam, {
  x=_x,
  y=_y,
  life=32,
  draw=function(self)
   circ(self.x+5,self.y+3,0.5,8)
  end,
  upd=function(self)
   self.y-=4
   self.life-=1
   if self.life<1 then
    del(plr.beam, self)
   end
   --todo collision detect
  end,
 })
end

function firebeam()
 if (plr.bdelay>0
  or #plr.beam>=plr.bmax) then
  plr.bdelay-=1
  return
 end
 plr.bdelay=plr.beam.delay
 newbeam(plr.x,plr.y)
end

function updbeam()
 for b in all(plr.beam) do
  b:upd()
 end
end

function drawbeam()
 for b in all(plr.beam) do
  b:draw()
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000600000005600000006000005650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000560000006000000065000056560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00484000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04888400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
41444140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01414100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04aaa400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000500005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000500005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0050055cc55005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005c55c11c55c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08551c1111c155300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
551cc55cc55cc1550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
511c11c55c11c1150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
51611cddddc116150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
561861dc561861dc561861dc561861dc561861dc561861dc561861dc561861dc0000000000000000000000000000000000000000000000000000000000000000
558885c5558885c5558885c5558885c5558885c5558885c5558885c5558885c50000000000000000000000000000000000000000000000000000000000000000
00999005009990050099900500099005000990050099000500990005009990050000000000000000000000000000000000000000000000000000000000000000
000aa000000aa000000aa000000a0000000a0000000a0000000a0000000aa0000000000000000000000000000000000000000000000000000000000000000000
007a000000070000000700000000a0000000a000000a000000a00000007a00000000000000000000000000000000000000000000000000000000000000000000
00700000000000000007000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
